Possible implementation improvements:

 - Rather than store lastSnapshot, etc. just store a array of known entries.
